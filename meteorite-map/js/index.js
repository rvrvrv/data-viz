'use strict';document.addEventListener('DOMContentLoaded',function(){function a(t,u,v){r.transition().duration(200).style('opacity',0.9),r.html('<h2>'+t.name+'</h2><h3>Year: '+t.year.slice(0,4)+'</h3><h3>Mass: '+t.mass+'</h3>').style('left',(u=u>0.7*window.innerWidth?u-150:u)+'px').style('top',(v=v>0.6*window.innerHeight?v-200:v+75)+'px')}function b(){r.transition().duration(400).style('opacity',0)}function c(){k.append('g').attr('class','land').selectAll('path').data([topojson.feature(worldMapData,worldMapData.objects.land)]).enter().append('path'),k.append('g').attr('class','boundaries').selectAll('path').data([topojson.feature(worldMapData,worldMapData.objects.countries)]).enter().append('path'),k.selectAll('path').attr('d',j),k.append('g').attr('class','meteorites').selectAll('path').data(meteoriteMapData).enter().append('circle').attr('class','meteorite').attr('cx',function(t){return i(t.geometry.coordinates)[0]}).attr('cy',function(t){return i(t.geometry.coordinates)[1]}).attr('r',function(t){return Math.floor(m(t.properties.mass))}).attr('fill',function(t){return'hsla('+t.properties.year.slice(0,4)+', 80%, 50%, '+n(t.properties.mass)+')'}).style('animation',function(){return'meteoriteEntrance '+(2*Math.random()+1)+'s ease-out'}).on('mouseover',function(t){window.event.buttons||a(t.properties,d3.event.x,d3.event.y)}).on('mouseout',function(){b()}).on('click',function(t){a(t.properties,d3.event.x,d3.event.y),setTimeout(b,1e3)})}function f(t,u){i=d3.geoMercator().translate([t/2,u/2]).scale(t/2/Math.PI),j=d3.geoPath().projection(i),k=d3.select('.map-container').append('svg').attr('width',t).attr('height',u).attr('class','world-map').call(s).append('g'),l=k.append('g'),c()}var i,j,k,l,m=d3.scalePow().exponent(0.5).domain([0.15,23000000]).range([1,80]),n=d3.scalePow().exponent(0.5).domain([0.15,23000000]).range([0.8,0.3]),o=document.getElementsByClassName('map-container')[0],p=o.offsetWidth,q=Math.min(0.7*p,window.innerHeight-100),r=d3.select('body').append('div').attr('class','tooltip'),s=d3.zoom().scaleExtent([1,9]).on('zoom',function(){var t=[d3.event.transform.x,d3.event.transform.y],u=d3.event.transform.k;t[0]=Math.min(p/q*(u-1),Math.max(p*(1-u),t[0])),t[1]=Math.min(q*(u-1)+q/5*u,Math.max(q*(1-u)-q/5*u,t[1])),k.attr('transform','translate('+t+') scale('+u+')')});d3.select(window).on('resize',function(){p=o.offsetWidth,q=Math.min(0.7*p,window.innerHeight-100),d3.select('svg').remove(),f(p,q),c()}),f(p,q)});
